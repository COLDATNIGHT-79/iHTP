{% extends "base.html" %}

{% block title %}Create Listing - iHateThisPerson{% endblock %}

{% block content %}
<div class="page-content">
    <div class="create-container">
        <!-- Left: Image Preview -->
        <div class="create-preview">
            <div class="preview-box" id="image-preview">
                <span class="preview-placeholder">image preview</span>
            </div>
            <p class="preview-hint">
                Upload any image (max 2MB)<br>
                Auto-compressed to ~3KB blocky style
            </p>
        </div>

        <!-- Right: Form -->
        <div class="create-form">
            <form action="/posts" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label class="file-upload-label">
                        <input type="file" name="image" accept="image/*" id="image-input" class="file-input" required>
                        <span class="file-upload-btn">üì∑ Choose Image *</span>
                        <span class="file-name" id="file-name">No file selected</span>
                    </label>
                </div>

                <div class="form-group">
                    <input type="text" name="title" class="form-input" placeholder="title *" maxlength="50" required>
                </div>

                <div class="form-group">
                    <textarea name="description" class="form-textarea" placeholder="description" maxlength="180"
                        rows="2"></textarea>
                </div>

                <div class="form-group">
                    <textarea name="reason" class="form-textarea" placeholder="reason for hate" maxlength="250"
                        rows="3"></textarea>
                </div>

                <div class="form-row">
                    <select name="tag1" class="form-select" required>
                        <option value="">tag 1 *</option>
                        <optgroup label="People">
                            <option value="celebrity">celebrity</option>
                            <option value="politician">politician</option>
                            <option value="influencer">influencer</option>
                            <option value="athlete">athlete</option>
                            <option value="musician">musician</option>
                            <option value="actor">actor</option>
                            <option value="ceo">ceo / business</option>
                            <option value="streamer">streamer</option>
                            <option value="youtuber">youtuber</option>
                        </optgroup>
                        <optgroup label="Personal">
                            <option value="my-friend">my friend</option>
                            <option value="my-ex">my ex</option>
                            <option value="my-boss">my boss</option>
                            <option value="coworker">coworker</option>
                            <option value="classmate">classmate</option>
                            <option value="teacher">teacher</option>
                            <option value="neighbor">neighbor</option>
                            <option value="family">family member</option>
                        </optgroup>
                        <optgroup label="Professional">
                            <option value="lawyer">lawyer</option>
                            <option value="doctor">doctor</option>
                            <option value="landlord">landlord</option>
                            <option value="scammer">scammer</option>
                            <option value="criminal">criminal</option>
                        </optgroup>
                        <optgroup label="Fictional">
                            <option value="fictional">fictional character</option>
                            <option value="villain">villain</option>
                            <option value="anime">anime character</option>
                        </optgroup>
                        <optgroup label="Other">
                            <option value="tech">tech bro</option>
                            <option value="karen">karen</option>
                            <option value="other">other</option>
                        </optgroup>
                    </select>
                    <select name="tag2" class="form-select">
                        <option value="">tag 2</option>
                        <optgroup label="Traits">
                            <option value="corrupt">corrupt</option>
                            <option value="liar">liar</option>
                            <option value="hypocrite">hypocrite</option>
                            <option value="narcissist">narcissist</option>
                            <option value="bully">bully</option>
                            <option value="annoying">annoying</option>
                            <option value="cringe">cringe</option>
                            <option value="overrated">overrated</option>
                            <option value="toxic">toxic</option>
                            <option value="fake">fake</option>
                        </optgroup>
                        <optgroup label="Actions">
                            <option value="scam">scam artist</option>
                            <option value="sellout">sellout</option>
                            <option value="snitch">snitch</option>
                            <option value="traitor">traitor</option>
                            <option value="cheater">cheater</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-group">
                    <select name="nationality" class="form-select full-width" id="nationality-select" required>
                        <option value="">nationality / origin *</option>
                        <option value="üåç">üåç Global / Unknown</option>
                    </select>
                </div>

                <button type="submit" class="btn-submit">Create Listing</button>
            </form>
        </div>
    </div>
</div>

<script>
    // Populate countries from REST Countries API
    fetch('https://restcountries.com/v3.1/all?fields=name,flag')
        .then(res => res.json())
        .then(countries => {
            const select = document.getElementById('nationality-select');
            countries
                .sort((a, b) => a.name.common.localeCompare(b.name.common))
                .forEach(country => {
                    const opt = document.createElement('option');
                    opt.value = country.flag;
                    opt.textContent = `${country.flag} ${country.name.common}`;
                    select.appendChild(opt);
                });
        })
        .catch(() => {
            // Fallback if API fails
            const fallback = ['üá∫üá∏ United States', 'üá¨üáß United Kingdom', 'üáÆüá≥ India', 'üá®üá¶ Canada', 'üá¶üá∫ Australia', 'üá©üá™ Germany', 'üá´üá∑ France', 'üáØüáµ Japan', 'üá®üá≥ China', 'üáßüá∑ Brazil'];
            const select = document.getElementById('nationality-select');
            fallback.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.split(' ')[0];
                opt.textContent = c;
                select.appendChild(opt);
            });
        });

    // Image preview
    document.getElementById('image-input').addEventListener('change', function (e) {
        const file = e.target.files[0];
        const preview = document.getElementById('image-preview');
        const fileName = document.getElementById('file-name');

        if (file) {
            if (file.size > 2 * 1024 * 1024) {
                alert('File too large! Max 2MB');
                e.target.value = '';
                return;
            }
            fileName.textContent = file.name;
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
            };
            reader.readAsDataURL(file);
        } else {
            preview.innerHTML = '<span class="preview-placeholder">image preview</span>';
            fileName.textContent = 'No file selected';
        }
    });
</script>
{% endblock %}