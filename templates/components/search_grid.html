{% if posts %}
<style>
    .search-results-container {
        padding: 25px;
    }

    .search-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #1a1a1a;
    }

    .search-header h2 {
        font-size: 14px;
        color: #1a1a1a;
    }

    .search-count {
        font-size: 12px;
        color: #666;
    }

    .highlight {
        background-color: #ffeb3b;
        padding: 1px 3px;
        border-radius: 2px;
        font-weight: bold;
    }
</style>

<div class="search-results-container">
    <div class="search-header">
        <h2>üîç Results for "{{ query }}"</h2>
        <span class="search-count">{{ posts|length }} found</span>
    </div>

    <div class="cards-grid">
        {% for post in posts %}
        <div class="pokemon-card">
            <div class="card-header">
                <span class="card-id">#{{ post.id | string | truncate(8, True, '') }}</span>
                {% if post.nationality %}
                <span class="card-flag">{{ post.nationality }}</span>
                {% endif %}
            </div>

            <div class="card-image-frame">
                {% if post.image_data %}
                <img src="data:image/jpeg;base64,{{ post.image_data }}" alt="{{ post.title }}"
                    style="image-rendering: pixelated;">
                {% else %}
                <div class="no-image">NO IMAGE</div>
                {% endif %}
            </div>

            <div class="card-body">
                <h3 class="card-title" data-highlight>{{ post.title }}</h3>

                {% if post.description %}
                <p class="card-desc" data-highlight>{{ post.description }}</p>
                {% endif %}

                {% if post.reason %}
                <div class="card-reason" data-highlight>
                    <strong>Reason:</strong> {{ post.reason }}
                </div>
                {% endif %}

                {% if post.tags %}
                <div class="card-tags">
                    {% for tag in post.tags %}
                    <span class="tag" data-highlight>{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="card-footer">
                <div class="card-stats">
                    <span class="card-date">{{ post.created_at.strftime('%b %d') }}</span>
                    <span class="card-likes">‚òÜ {{ post.like_count }}</span>
                </div>
                <div class="card-actions">
                    <a href="/post/{{ post.id }}" class="btn-share" title="View post">üîó</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Hide main feed when search results are shown
    (function () {
        const feed = document.getElementById('feed');
        if (feed) feed.style.display = 'none';

        // Highlight search terms
        const query = "{{ query | lower }}";
        if (query) {
            document.querySelectorAll('[data-highlight]').forEach(el => {
                const text = el.innerHTML;
                const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                el.innerHTML = text.replace(regex, '<span class="highlight">$1</span>');
            });
        }
    })();
</script>

{% elif query %}
<div class="search-results-container" style="padding: 25px;">
    <div class="empty-state">No results for "{{ query }}"</div>
</div>
<script>
    // Hide main feed for no results too
    (function () {
        const feed = document.getElementById('feed');
        if (feed) feed.style.display = 'none';
    })();
</script>

{% else %}
<script>
    // Show main feed when search is cleared
    (function () {
        const feed = document.getElementById('feed');
        if (feed) feed.style.display = '';
    })();
</script>
{% endif %}